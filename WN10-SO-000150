# Remediate WN10-SO-000150 - Prevent anonymous enumeration of shares

$RegPath = "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa"

# Create the key if it doesn't exist
if (!(Test-Path $RegPath)) {
    New-Item -Path $RegPath -Force | Out-Null
}

# RestrictAnonymous values:
# 0 = None. Rely on Default Permissions.
# 1 = Do not allow enumeration of SAM accounts and shares.
# 2 = No access without explicit anonymous permissions.
Set-ItemProperty -Path $RegPath -Name "RestrictAnonymous" -Value 1 -Type DWord -Force

Write-Host "Anonymous enumeration of shares disabled (RestrictAnonymous = 1)."

Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa" | Select-Object RestrictAnonymous
